commands and code that used

txt file that will host the IP address:
stored on ubuntu that will host conataner for the file

docker file to create the server that will host the file:

# Use a lightweight Python image
FROM python:3.9-slim

# Set the working directory
WORKDIR /app

# Copy the malicious IPs file to the container
COPY malicious_ips.txt /app/malicious_ips.txt

# Expose port 8080
EXPOSE 8080

# Start a Python web server that serves files from /app
CMD ["python", "-m", "http.server", "8080"]

build with command:

docker build -t ip-blocklist-server .

run the container 

docker run ip-blocklist-server

after that create the Policy in forti to block the the policy name is Protect with Threat Feed

got the file hosted on the docker and part from active rule now to the Wzuh.

the rule for Wazuh:

<!-- Local rules -->

<!-- Modify it at your will. -->
<!-- Copyright (C) 2015, Wazuh Inc. -->

<!-- Example -->
<group name="custom,">
    <rule id="100200" level="10">
        <decoded_as>syslog</decoded_as>
        <match>malicious_ip</match> <!-- Adjust this match pattern -->
        <description>Detected malicious IP from honeypot</description>
        <options>no_full_log</options>
        <action>exec</action>
        <command>/path/to/check_ip_reputation.py</command> <!-- Your script here -->
    </rule>
</group>

as we see in the rule we need to creat API for IP scan done with abuseIPDB and to match the log with "malicious_ip"
Api code
import requests

# Your AbuseIPDB API key
API_KEY = 'your_api_key_here'

# Function to check IP against AbuseIPDB
def check_ip(ip):
    url = f'https://api.abuseipdb.com/api/v2/check'
    headers = {
        'Accept': 'application/json',
        'Key': API_KEY
    }
    params = {
        'ipAddress': ip,
        'maxAgeInDays': 30  # Adjust as needed
    }
    
    response = requests.get(url, headers=headers, params=params)
    
    if response.status_code == 200:
        return response.json()
    else:
        print(f"Error: {response.status_code} - {response.text}")
        return None

# Read IPs from text file
def read_ips_from_file(file_path):
    with open(file_path, 'r') as file:
        return [line.strip() for line in file if line.strip()]

# Main function
def main():
    file_path = 'ips.txt'  # Path to your text file with IPs
    ips = read_ips_from_file(file_path)
    
    for ip in ips:
        result = check_ip(ip)
        if result:
            print(f"Results for {ip}: {result}")

if __name__ == "__main__":
    main()

at this point we need to make sure that we are detecting logs by the rule ,
!make sure to update malicious_ip tag at the rule!

Created Tpot:
used this for honey pot https://github.com/telekom-security/tpotce?tab=readme-ov-file#choose-your-distro

set up on aws cloud
